#!/bin/bash

BUILD_DIR=${1:-}

uname -a

INSTALL_DIR="$BUILD_DIR/.bp/"
mkdir -p ${INSTALL_DIR}

pushd ${INSTALL_DIR}
  wget --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/8u77-b03/jre-8u77-linux-x64.tar.gz
  tar -zxf jre-8u77-linux-x64.tar.gz
  ln -s jre1.8.0_77 jre
popd
export PATH="${INSTALL_DIR}/jre/bin":$PATH

pushd ${INSTALL_DIR}
  wget https://download.elastic.co/logstash/logstash/logstash-2.3.0.tar.gz
  tar -zxf logstash-2.3.0.tar.gz
  ln -s logstash-2.3.0 logstash
popd
export PATH="${INSTALL_DIR}/logstash/bin":$PATH

ls -l ${INSTALL_DIR}
ls -l ${INSTALL_DIR}/jre/
ls -l ${INSTALL_DIR}/logstash/

mkdir -p $BUILD_DIR/.profile.d
ENV_FILE=$BUILD_DIR/.profile.d/setenv.sh
> $ENV_FILE
echo "export PATH=\"${INSTALL_DIR}/jre/bin\":\$PATH" >> $ENV_FILE
echo "export PATH=\"${INSTALL_DIR}/logstash/bin\":\$PATH" >> $ENV_FILE

cat $ENV_FILE
ls -l $ENV_FILE

ls -la ./
pwd
which logstash
date
logstash agent -vvvv
date
